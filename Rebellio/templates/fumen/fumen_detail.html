{% extends 'base.html' %}
{% load static %}
{% block css %}
{% endblock %}

{% block content %}
    <div class="d-flex flex-row bd-highlight mb-3">
        {% include 'fumen/fumen_navigator.html' %}
        <div class="p-2 bd-highlight col-sm-11">
            <div class="card text-black border-secondary mb-3" style="max-width: 100rem;">
                <div class="card-header" style="background-color:#d0c8c8;"><strong>谱面信息 / Fumen details</strong></div>
                <div class="card-body">
                    <div class="fumen-details-content">
                        <div class="row">
                            <div class="col-md-6" style="text-align:left">
                                <h4>{{ result.fumen.title }}</h4>
                                <p><small class="text-muted"><strong id="fumen_id">{{ result.fumen.songid }}</strong></small></p>
                                {% if result.fumen.difficulty == 0 %}
                                <p style="font-size:24px;color:#19A403;"><strong id="difficulty">BASIC</strong></p>
                                {% elif result.fumen.difficulty == 1 %}
                                <p style="font-size:24px;color:#FF8A01"><strong id="difficulty">MEDIUM</strong></p>
                                {% elif result.fumen.difficulty == 2 %}
                                <p style="font-size:24px;color:#F30A0A;"><strong id="difficulty">HARD</strong></p>
                                {% else %}
                                <p style="font-size:24px;color:#00D2E9;"><strong id="difficulty">SPECIAL</strong></p>
                                {% endif %}
                            </div>
                            <div class="col-md-5">
                            </div>
                            <div class="col-md-1">
                            </div>
                        </div>
                        <div class="border-top my-3"></div>
                        <div class="row">
                            <div class="container col-md-6" style="text-align:left;">
                                <p class="card-text"><strong>作曲家 / Artist:&nbsp&nbsp&nbsp&nbsp</strong><a href='/fumen/fumens?keyword={{ result.fumen.artist }}'>{{ result.fumen.artist }}</a></p>
                                <p class="card-text"><strong>做谱人 / Chart author:&nbsp&nbsp&nbsp&nbsp</strong><a href='/fumen/fumens?fumen_creator={{ result.fumen.chartauthor }}'>{{ result.fumen.chartauthor }}</a></p>
                                <p class="card-text"><strong>难度 / Difficulty:&nbsp&nbsp&nbsp&nbsp</strong><a href="/fumen/fumens?level={{ result.fumen.diff }}">{{ result.fumen.diff }}</a></p>
                                {% if request.session.user_access_level >= 1 %}
                                    <p class="card-text"><strong>上传者 / Uploader:&nbsp&nbsp&nbsp&nbsp</strong>{{ result.fumen.creator }}</p>
                                {% endif %}
                                <p class="card-text"><strong>创建时间 / Create time:&nbsp&nbsp&nbsp&nbsp</strong>{{ result.fumen.createtime }}</p>
                                <p class="card-text"><strong>发布时间 / Publish time:&nbsp&nbsp&nbsp&nbsp</strong>{{ result.fumen.publishtime }}</p>
                                {% if request.session.user_access_level >= 1 %}
                                    {% if result.fumen.category == 0 %}
                                        <p class="card-text"><strong>谱面类型 / Fumen type:&nbsp&nbsp&nbsp&nbsp</strong>已发布</p>
                                    {% endif %}
                                    {% if result.fumen.category == 1 %}
                                        <p class="card-text"><strong>谱面类型 / Fumen type:&nbsp&nbsp&nbsp&nbsp</strong>审核中</p>
                                    {% endif %}
                                    {% if result.fumen.category == 2 %}
                                        <p class="card-text"><strong>谱面类型 / Fumen type:&nbsp&nbsp&nbsp&nbsp</strong>官谱</p>
                                    {% endif %}
                                    {% if result.fumen.category == 3 %}
                                        <p class="card-text"><strong>谱面类型 / Fumen type:&nbsp&nbsp&nbsp&nbsp</strong>内测</p>
                                    {% endif %}
                                {% endif %}
                            </div>
                            <div class="container col-md-6" style="text-align:right;">
                                <img src="https://chilundui.com/data/rbdx/image/song/{{ result.fumen.songid }}.png" style="max-width:300px;max-height:300px;">
                            </div>
                        </div>
                        <div class="border-top my-3"></div>
                        <div>
                            <div class="container col-md-12" style="float:left;">
                                <blockquote class="blockquote">
                                    {% if result.fumen.authordescription != '' %}
                                        <p style="color:grey;font-size:16px;text-indent:2ch">{{ result.fumen.authordescription }}</p>
                                    {% else %}
                                        <p style="color:grey;font-size:16px;text-indent:2ch">这个做谱人很懒，什么都没留下</p>
                                    {% endif %}
                                    <footer class="blockquote-footer text-right">{{ result.fumen.chartauthor }}</footer>
                                </blockquote>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card text-black border-secondary mb-3" style="max-width:100rem;">
                <div class="card-header" style="background-color:#d0c8c8;"><strong>高分榜 / High score</strong></div>
                <div class="card-body">
                    {% if result.fumen_player_best_record %}
                    <h5 class="card-title" style="font-size:16px;">我的 / My best rank</h5>
                    <div class="card mb-3" style="max-width:100rem;background-color:#bfbf73;border-color:#bfbf73;">
                        <div class="row" style="padding:10px">
                            <div class="container col-md-1 align-self-center">
                                <p class="card-text" style="margin-left:30px"><span style="color:black;font-size:24px">{{ result.fumen_player_best_record.ranking }}</span></p>
                            </div>
                            <div class="container col-md-1 align-self-center">
                                <img src="https://chilundui.com/data/rbdx/image/song/{{ result.fumen_player_best_record.avatar }}.png" style="max-width:75px;height:75px;border-radius:50%;">
                            </div>
                            <div class="container col-md-2 align-self-center">
                                <p class="card-text" align="center"><span style="color:black;font-size:16px"><a href="/user/user_detail?user_name={{ result.fumen_player_best_record.accountname }}">{{ result.fumen_player_best_record.accountname }}</a></span></p>
                            </div>
                            <div class="container col-md-2 align-self-center">
                                {% if result.fumen_player_best_record.rank == "EXC" %}
                                    <p class="card-text" align="center"><span style="color:#715fd3;font-size:32px;"><strong>{{ result.fumen_player_best_record.rank }}</strong></span></p>
                                {% elif result.fumen_player_best_record.rank == "S" %}
                                    <p class="card-text" align="center"><span style="color:#20a6df;font-size:32px;"><strong>{{ result.fumen_player_best_record.rank }}</strong></span></p>
                                {% else %}
                                    <p class="card-text" align="center"><span style="color:grey;font-size:32px;"><strong>{{ result.fumen_player_best_record.rank }}</strong></span></p>
                                {% endif %}
                            </div>
                            <div class="container col-md-2">
                                {% if result.fumen_player_best_record.ar != 0.0 %}
                                    <p class="card-text"><strong>AR:&nbsp</strong><span style="color:black;font-size:16px">{{ result.fumen_player_best_record.ar }}%</span></p>
                                {% else %}
                                    <p class="card-text"><strong>SR:&nbsp</strong><span style="color:black;font-size:16px">{{ result.fumen_player_best_record.sr }}%</span></p>
                                {% endif %}
                                <p class="card-text"><strong>Score:&nbsp</strong><span style="color:black;font-size:16px">{{ result.fumen_player_best_record.score }}</span></p>
                            </div>
                            <div class="container col-md-2">
                                {% if result.fumen_player_best_record.jr != -1 %}
                                <p class="card-text"><strong>JR:&nbsp</strong><span style="color:black;font-size:16px">{{ result.fumen_player_best_record.jr }}</span></p>
                                {% else %}
                                <p class="card-text"><strong>JR:&nbsp</strong><span style="color:black;font-size:16px">-</span></p>
                                {% endif %}
                                {% if result.fumen_player_best_record.difficulty == 0 %}
                                <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#19A403;font-size:16px"><strong>BASIC</strong></span></p>
                                {% elif result.fumen_player_best_record.difficulty == 1 %}
                                <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#FF8A01;font-size:16px"><strong>MEDIUM</strong></span></p>
                                {% elif result.fumen_player_best_record.difficulty == 2 %}
                                <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#F30A0A;font-size:16px"><strong>HARD</strong></span></p>
                                {% else %}
                                <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#00D2E9;font-size:16px"><strong>SPECIAL</strong></span></p>
                                {% endif %}
                            </div>
                            <div class="container col-md-2">
                                <p class="card-text"><small style="color:grey;font-size:12px">{{ result.fumen_player_best_record.logtime }}</small></p>
                            </div>
                        </div>
                    </div>
                    <div class="border-top my-3"></div>
                    {% endif %}
                    <h5 class="card-title" style="font-size:16px;">排行榜 / Ranks</h5>
                    {% if result.fumen_best_record %}
                        {% if request.session.user_name == result.fumen_best_record.accountname %}
                        <div class="card mb-3" style="max-width:100rem;background-color:#bfbf73;border-color:#bfbf73;">
                        {% else %}
                        <div class="card mb-3" style="max-width:100rem;background-color:gold;border-color:gold;">
                        {% endif %}
                            <div class="row" style="padding:10px">
                                <div class="container col-md-1 align-self-center">
                                    <p class="card-text" style="margin-left:30px"><span style="color:black;font-size:24px">{{ result.fumen_best_record.ranking }}</span></p>
                                </div>
                                <div class="container col-md-1 align-self-center">
                                    <img src="https://chilundui.com/data/rbdx/image/song/{{ result.fumen_best_record.avatar }}.png" style="max-width:75px;height:75px;border-radius:50%;">
                                </div>
                                <div class="container col-md-2 align-self-center">
                                    <p class="card-text" align="center"><span style="color:black;font-size:16px"><a href="/user/user_detail?user_name={{ result.fumen_best_record.accountname }}">{{ result.fumen_best_record.accountname }}</a></span></p>
                                </div>
                                <div class="container col-md-2 align-self-center">
                                    {% if result.fumen_best_record.rank == "EXC" %}
                                        <p class="card-text" align="center"><span style="color:#715fd3;font-size:32px;"><strong>{{ result.fumen_best_record.rank }}</strong></span></p>
                                    {% elif result.fumen_best_record.rank == "S" %}
                                        <p class="card-text" align="center"><span style="color:#20a6df;font-size:32px;"><strong>{{ result.fumen_best_record.rank }}</strong></span></p>
                                    {% else %}
                                        <p class="card-text" align="center"><span style="color:grey;font-size:32px;"><strong>{{ result.fumen_best_record.rank }}</strong></span></p>
                                    {% endif %}
                                </div>
                                <div class="container col-md-2">
                                    {% if result.fumen_best_record.ar != 0.0 %}
                                        <p class="card-text"><strong>AR:&nbsp</strong><span style="color:black;font-size:16px">{{ result.fumen_best_record.ar }}%</span></p>
                                    {% else %}
                                        <p class="card-text"><strong>SR:&nbsp</strong><span style="color:black;font-size:16px">{{ result.fumen_best_record.sr }}%</span></p>
                                    {% endif %}
                                    <p class="card-text"><strong>Score:&nbsp</strong><span style="color:black;font-size:16px">{{ result.fumen_best_record.score }}</span></p>
                                </div>
                                <div class="container col-md-2">
                                    {% if result.fumen_best_record.jr != -1 %}
                                    <p class="card-text"><strong>JR:&nbsp</strong><span style="color:black;font-size:16px">{{ result.fumen_best_record.jr }}</span></p>
                                    {% else %}
                                    <p class="card-text"><strong>JR:&nbsp</strong><span style="color:black;font-size:16px">-</span></p>
                                    {% endif %}
                                    {% if result.fumen_best_record.difficulty == 0 %}
                                    <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#19A403;font-size:16px"><strong>BASIC</strong></span></p>
                                    {% elif result.fumen_best_record.difficulty == 1 %}
                                    <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#FF8A01;font-size:16px"><strong>MEDIUM</strong></span></p>
                                    {% elif result.fumen_best_record.difficulty == 2 %}
                                    <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#F30A0A;font-size:16px"><strong>HARD</strong></span></p>
                                    {% else %}
                                    <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#00D2E9;font-size:16px"><strong>SPECIAL</strong></span></p>
                                    {% endif %}
                                </div>
                                <div class="container col-md-2">
                                    <p class="card-text"><small style="color:grey;font-size:12px">{{ result.fumen_best_record.logtime }}</small></p>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {% for record in result.fumen_records %}
                        {% if request.session.user_name == record.accountname %}
                        <div class="card mb-3" style="max-width:100rem;background-color:#bfbf73;border-color:#bfbf73;">
                        {% else %}
                        <div class="card mb-3" style="max-width:100rem;background-color:#cae8e8;border-color:#cae8e8;">
                        {% endif %}
                            <div class="row" style="padding:10px">
                                <div class="container col-md-1 align-self-center">
                                    <p class="card-text" style="margin-left:30px"><span style="color:black;font-size:24px">{{ record.ranking }}</span></p>
                                </div>
                                <div class="container col-md-1 align-self-center">
                                    <img src="https://chilundui.com/data/rbdx/image/song/{{ record.avatar }}.png" style="max-width:75px;height:75px;border-radius:50%;">
                                </div>
                                <div class="container col-md-2 align-self-center">
                                    <p class="card-text" align="center"><span style="color:black;font-size:16px"><a href="/user/user_detail?user_name={{ record.accountname }}">{{ record.accountname }}</a></span></p>
                                </div>
                                <div class="container col-md-2 align-self-center">
                                    {% if record.rank == "EXC" %}
                                        <p class="card-text" align="center"><span style="color:#715fd3;font-size:32px;"><strong>{{ record.rank }}</strong></span></p>
                                    {% elif record.rank == "S" %}
                                        <p class="card-text" align="center"><span style="color:#20a6df;font-size:32px;"><strong>{{ record.rank }}</strong></span></p>
                                    {% else %}
                                        <p class="card-text" align="center"><span style="color:grey;font-size:32px;"><strong>{{ record.rank }}</strong></span></p>
                                    {% endif %}
                                </div>
                                <div class="container col-md-2">
                                    {% if record.ar != 0.0 %}
                                        <p class="card-text"><strong>AR:&nbsp</strong><span style="color:black;font-size:16px">{{ record.ar }}%</span></p>
                                    {% else %}
                                        <p class="card-text"><strong>SR:&nbsp</strong><span style="color:black;font-size:16px">{{ record.sr }}%</span></p>
                                    {% endif %}
                                    <p class="card-text"><strong>Score:&nbsp</strong><span style="color:black;font-size:16px">{{ record.score }}</span></p>
                                </div>
                                <div class="container col-md-2">
                                    {% if record.jr != -1 %}
                                        <p class="card-text"><strong>JR:&nbsp</strong><span style="color:black;font-size:16px">{{ record.jr }}</span></p>
                                    {% else %}
                                        <p class="card-text"><strong>JR:&nbsp</strong><span style="color:black;font-size:16px">-</span></p>
                                    {% endif %}
                                    {% if record.difficulty == 0 %}
                                    <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#19A403;font-size:16px"><strong>BASIC</strong></span></p>
                                    {% elif record.difficulty == 1 %}
                                    <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#FF8A01;font-size:16px"><strong>MEDIUM</strong></span></p>
                                    {% elif record.difficulty == 2 %}
                                    <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#F30A0A;font-size:16px"><strong>HARD</strong></span></p>
                                    {% else %}
                                    <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#00D2E9;font-size:16px"><strong>SPECIAL</strong></span></p>
                                    {% endif %}
                                </div>
                                <div class="container col-md-2">
                                    <p class="card-text"><small style="color:grey;font-size:12px">{{ record.logtime }}</small></p>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <div class="card text-black border-secondary mb-3" style="max-width: 100rem;">
                <div class="card-header" style="background-color:#d0c8c8;"><strong>我的游玩历史 / My play history</strong></div>
                <div class="card-body">
                    {% if result.fumen_player_best_record %}
                        <h5 class="card-title" style="font-size:16px;">最高成绩 / Best play</h5>
                        <div class="card mb-3" style="max-width:100rem;background-color:gold;border-color:gold;">
                            <div class="row" style="padding:10px">
                                <div class="container col-md-1 align-self-center">
                                    <p class="card-text" style="margin-left:30px"><span style="color:black;font-size:24px">{{ result.fumen_player_best_record.ranking }}</span></p>
                                </div>
                                <div class="container col-md-2 align-self-center">
                                    {% if result.fumen_player_best_record.rank == "EXC" %}
                                        <p class="card-text"><span style="color:#715fd3;font-size:32px;"><strong>{{ result.fumen_player_best_record.rank }}</strong></span></p>
                                    {% elif result.fumen_player_best_record.rank == "S" %}
                                        <p class="card-text"><span style="color:#20a6df;font-size:32px;"><strong>{{ result.fumen_player_best_record.rank }}</strong></span></p>
                                    {% else %}
                                        <p class="card-text"><span style="color:grey;font-size:32px;"><strong>{{ result.fumen_player_best_record.rank }}</strong></span></p>
                                    {% endif %}
                                </div>
                                <div class="container col-md-2">
                                    {% if result.fumen_player_best_record.ar != 0.0 %}
                                        <p class="card-text"><strong>AR:&nbsp</strong><span style="color:black;font-size:16px">{{ result.fumen_player_best_record.ar }}%</span></p>
                                    {% else %}
                                        <p class="card-text"><strong>SR:&nbsp</strong><span style="color:black;font-size:16px">{{ result.fumen_player_best_record.sr }}%</span></p>
                                    {% endif %}
                                    <p class="card-text"><strong>Score:&nbsp</strong><span style="color:black;font-size:16px">{{ result.fumen_player_best_record.score }}</span></p>
                                </div>
                                <div class="container col-md-2">
                                    {% if result.fumen_player_best_record.jr != -1 %}
                                        <p class="card-text"><strong>JR:&nbsp</strong><span style="color:black;font-size:16px">{{ result.fumen_player_best_record.jr }}</span></p>
                                    {% else %}
                                        <p class="card-text"><strong>JR:&nbsp</strong><span style="color:black;font-size:16px">-</span></p>
                                    {% endif %}
                                    {% if result.fumen_player_best_record.difficulty == 0 %}
                                    <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#19A403;font-size:16px"><strong>BASIC</strong></span></p>
                                    {% elif result.fumen_player_best_record.difficulty == 1 %}
                                    <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#FF8A01;font-size:16px"><strong>MEDIUM</strong></span></p>
                                    {% elif result.fumen_player_best_record.difficulty == 2 %}
                                    <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#F30A0A;font-size:16px"><strong>HARD</strong></span></p>
                                    {% else %}
                                    <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#00D2E9;font-size:16px"><strong>SPECIAL</strong></span></p>
                                    {% endif %}
                                </div>
                                <div class="container col-md-2">
                                    <p class="card-text"><small style="color:grey;font-size:12px">{{ result.fumen_player_best_record.logtime }}</small></p>
                                </div>
                            </div>
                        </div>
                        <div class="border-top my-3"></div>
                    {% endif %}
                    {% if result.fumen_player_records %}
                        <h5 class="card-title" style="font-size:16px;">历史成绩 / Play history</h5>
                        {% for record in result.fumen_player_records %}
                            <div class="card mb-3" style="max-width:100rem;background-color:#cae8e8;border-color:#cae8e8;">
                                <div class="row" style="padding:10px">
                                    <div class="container col-md-2 align-self-center">
                                        {% if record.rank == "EXC" %}
                                            <p class="card-text"><span style="color:#715fd3;font-size:32px;"><strong>{{ record.rank }}</strong></span></p>
                                        {% elif record.rank == "S" %}
                                            <p class="card-text"><span style="color:#20a6df;font-size:32px;"><strong>{{ record.rank }}</strong></span></p>
                                        {% else %}
                                            <p class="card-text"><span style="color:grey;font-size:32px;"><strong>{{ record.rank }}</strong></span></p>
                                        {% endif %}
                                    </div>
                                    <div class="container col-md-2">
                                        {% if record.ar != 0.0 %}
                                            <p class="card-text"><strong>AR:&nbsp</strong><span style="color:black;font-size:16px">{{ record.ar }}%</span></p>
                                        {% else %}
                                            <p class="card-text"><strong>SR:&nbsp</strong><span style="color:black;font-size:16px">{{ record.sr }}%</span></p>
                                        {% endif %}
                                        <p class="card-text"><strong>Score:&nbsp</strong><span style="color:black;font-size:16px">{{ record.score }}</span></p>
                                    </div>
                                    <div class="container col-md-2">
                                        {% if record.jr != -1 %}
                                            <p class="card-text"><strong>JR:&nbsp</strong><span style="color:black;font-size:16px">{{ record.jr }}</span></p>
                                        {% else %}
                                            <p class="card-text"><strong>JR:&nbsp</strong><span style="color:black;font-size:16px">-</span></p>
                                        {% endif %}
                                        {% if record.difficulty == 0 %}
                                        <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#19A403;font-size:16px"><strong>BASIC</strong></span></p>
                                        {% elif record.difficulty == 1 %}
                                        <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#FF8A01;font-size:16px"><strong>MEDIUM</strong></span></p>
                                        {% elif record.difficulty == 2 %}
                                        <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#F30A0A;font-size:16px"><strong>HARD</strong></span></p>
                                        {% else %}
                                        <p class="card-text"><strong>Difficulty:&nbsp</strong><span style="color:#00D2E9;font-size:16px"><strong>SPECIAL</strong></span></p>
                                        {% endif %}
                                    </div>
                                    <div class="container col-md-2">
                                        <p class="card-text"><small style="color:grey;font-size:12px">{{ record.logtime }}</small></p>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                    <p class="card-text"><small style="font-size:16px;">无记录成绩 / No record</small></p>
                    {% endif %}
                </div>
            </div>
        <div class="card text-black border-info mb-3" style="max-width: 100rem;">
                <div class="card-header" style="background-color:#d0c8c8;"><strong>评论信息 / Comments</strong></div>
                <div class="card-body">
                    {% if result.fumen_comments %}
                        {% for comment in result.fumen_comments %}
                            <div class="card text-black border-secondary mb-3" style="max-width: 100rem; margin-top: auto;">
                                {% if result.fumen.category == 1 and comment.isok == 1 %}
                                <div class="card-header" style="font-size:14px;background-color:#00ff00;"><strong>评论人: </strong><a href="/user/user_detail?user_name={{ comment.accountname }}">{{ comment.accountname }}</a>&nbsp&nbsp<strong>评论时间: </strong>{{ comment.createtime }}</div>
                                {% elif result.fumen.category == 1 and comment.isok == 0 and comment.isviewedbyauthor == 1 %}
                                <div class="card-header" style="font-size:14px;background-color:#ffff80;"><strong>评论人: </strong><a href="/user/user_detail?user_name={{ comment.accountname }}">{{ comment.accountname }}</a>&nbsp&nbsp<strong>评论时间: </strong>{{ comment.createtime }}&nbsp&nbsp<strong>做谱人确认时间: </strong>{{ comment.authorviewtime }}</div>
                                {% elif result.fumen.category == 1 %}
                                <div class="card-header" style="font-size:14px;background-color:#ff3333;"><strong>评论人: </strong><a href="/user/user_detail?user_name={{ comment.accountname }}">{{ comment.accountname }}</a>&nbsp&nbsp<strong>评论时间: </strong>{{ comment.createtime }}</div>
                                {% else %}
                                <div class="card-header" style="font-size:14px;"><strong>评论人: </strong><a href="/user/user_detail?user_name={{ comment.accountname }}">{{ comment.accountname }}</a>&nbsp&nbsp<strong>评论时间: </strong>{{ comment.updatetime }}</div>
                                {% endif %}
                                <div class="card-body">
                                    {% if request.session.user_name == comment.accountname or request.session.user_access_level >= 3 %}
                                    <textarea class="col-md-12" type="text" name="comment" style="font-size:14px;">{{ comment.comment }}</textarea>
                                    <p class="difficulty" style="font-size:14px;display:none">{{ result.fumen.difficulty }}</p>
                                    <p class="fumen_id" style="font-size:14px;display:none">{{ result.fumen.songid }}</p>
                                    <p class="comment_id" style="font-size:14px;display:none">{{ comment.id }}</p>
                                    {% if result.fumen.category == 1 and request.session.user_access_level >= 1 %}
                                    <select class="col-md-2 mr-sm-2 is_ok" style="display:inline">
                                        {% if comment.isok == 1 %}
                                        <option value=1 selected>ok</option>
                                        {% else %}
                                        <option value=1>ok</option>
                                        {% endif %}
                                        {% if comment.isok == 0 %}
                                        <option value=0 selected>not ok</option>
                                        {% else %}
                                        <option value=0>not ok</option>
                                        {% endif %}
                                    </select>
                                    {% endif %}
                                    <button class="btn btn-outline-success update_fumen_comment" type="button" style="font-size:14px;">修改</button>
                                    <button class="btn btn-outline-success delete_fumen_comment" type="button" style="font-size:14px;">删除</button>
                                    {% if request.session.user_name == result.fumen.creator and comment.isok == 0 and comment.isviewedbyauthor == 0 %}
                                    <button class="btn btn-outline-success view_fumen_comment" type="button" style="font-size:14px;">确认</button>
                                    {% endif %}
                                    {% else %}
                                    <p class="card-text">{{ comment.comment }}</p>
                                    {% if request.session.user_name == result.fumen.creator and comment.isok == 0 and comment.isviewedbyauthor == 0 %}
                                    <p class="comment_id" style="font-size:14px;display:none">{{ comment.id }}</p>
                                    <button class="btn btn-outline-success view_fumen_comment" type="button" style="font-size:14px;">确认</button>
                                    {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                    <p class="card-text"><small style="font-size:16px;">无评论 / No comment</small></p>
                    {% endif %}
                </div>
                <div class="card-body">
                    <div class="card text-black mb-3" style="max-width: 100rem; margin-top: auto; background-color: bisque;border-color:bisque;">
                        <div class="card-body">
                            <textarea class="col-md-12" name="comment" id="comment" placeholder="输入评论 / Input comment"></textarea>
                            <p class="difficulty" style="font-size:14px;display:none">{{ result.fumen.difficulty }}</p>
                            <p class="fumen_id" style="font-size:14px;display:none">{{ result.fumen.songid }}</p>
                            {% if result.fumen.category == 1 and request.session.user_access_level >= 1 %}
                            <select class="col-md-2 is_ok" style="display:inline">
                                <option value=1 selected>ok</option>
                                <option value=0>not ok</option>
                            </select>
                            {% endif %}
                            <button class="btn btn-outline-success create_fumen_comment" type="button">提交</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
    <script type="text/javascript">
        $(".create_fumen_comment").click(function() {
		    console.log("click on btn_create_fumen_comment");
		    const parentNode = $(this).parent();
            const comment = parentNode.children("textarea").val();
            let is_ok = parentNode.find(".is_ok").val();
            if (!is_ok) {
                is_ok = 1;
            }
            const fumen_id = parentNode.find(".fumen_id").html();
            const difficulty = parentNode.find(".difficulty").html();
            const url = "/fumen/create_fumen_comment?"+"fumen_id="+fumen_id+"&difficulty="+difficulty+"&comment="+comment+"&is_ok="+is_ok;
            $.get(url, function ( data ) {
                if (!data.result) {
                    alert("新增评论失败!")
                } else {
                    location.reload();
                }
            });
        });

        $(".update_fumen_comment").click(function() {
		    console.log("click on btn_update_fumen_comment");]
		    const parentNode = $(this).parent();
            const comment = parentNode.children("textarea").val();
            let is_ok = parentNode.find(".is_ok").val();
            if (!is_ok) {
                is_ok = 1;
            }
            const comment_id = parentNode.find(".comment_id").html();
            const fumen_id = parentNode.find(".fumen_id").html();
            const difficulty = parentNode.find(".difficulty").html();
            const url = "/fumen/update_fumen_comment?"+"fumen_id="+fumen_id+"&comment_id="+comment_id+"&difficulty="+difficulty+"&comment="+comment+"&is_ok="+is_ok;
            $.get(url, function ( data ) {
                if (!data.result) {
                    alert("修改评论失败!")
                } else {
                    location.reload();
                }
            });
        });

        $(".delete_fumen_comment").click(function() {
		    console.log("click on btn_delete_fumen_comment");
		    const parentNode = $(this).parent();
            const comment_id = parentNode.find(".comment_id").html();
            const fumen_id = parentNode.find(".fumen_id").html();
            const difficulty = parentNode.find(".difficulty").html();
            const url = "/fumen/delete_fumen_comment?"+"fumen_id="+fumen_id+"&comment_id="+comment_id+"&difficulty="+difficulty;
            $.get(url, function ( data ) {
                if (!data.result) {
                    alert("删除评论失败!")
                } else {
                    location.reload();
                }
            });
        });

        $(".view_fumen_comment").click(function() {
		    console.log("click on btn_view_fumen_comment");
		    const parentNode = $(this).parent();
            const comment_id = parentNode.find(".comment_id").html();
            const url = "/inner/view_fumen_comment?"+"comment_id="+comment_id;
            $.get(url, function ( data ) {
                if (!data.result) {
                    alert("确认评论失败!")
                } else {
                    location.reload();
                }
            });
        });
    </script>
{% endblock %}